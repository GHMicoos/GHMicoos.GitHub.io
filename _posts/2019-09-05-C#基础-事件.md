---
layout: post
title:  "C#基础 事件"
categories: C#基础
tags: C#基础 事件
author: GHMicoos
---


* content
{:toc}
事件




### 二 事件

* 事件基于委托，为委托提供一种发布/订阅机制。

事件的特点
`public delegate void EventHandler<TEventArgs>(object sender, TEventArgs e);`
* 事件一般使用带两个参数的方法；其中一个参数是一个对象，包含事件的发送者；第二个参数提供事件的相关信息。

``` js

class CarInfoEventArgs : EventArgs
{
    public string Car { get; private set; }
    public CarInfoEventArgs(string car)
        => Car = car;
}

class CarDealer
{
//可以使用下面的 C#的简化写法
//public event EventHandler<CarInfoEventArgs> NewCarInfo;
    private EventHandler<CarInfoEventArgs> _newCarInfo;
    public event EventHandler<CarInfoEventArgs> NewCarInfo
    {
        add { _newCarInfo += value; }
        remove { _newCarInfo -= value; }
    }


    public void NewCar(string car)
    {
        Console.WriteLine($"CarDealer,new car {car}");
        if (_newCarInfo != null)
        {
        _newCarInfo(this, new CarInfoEventArgs(car));
        }
    }
}

class Customer
{
    private string name;
    public Customer(string name)
        => this.name = name;

    public void NewCarIsHere(object sender, CarInfoEventArgs e)
    {
        Console.WriteLine($"{name}:car {e.Car} is new");
    }
}

//测试代码
var dealer = new CarDealer();
//michael对象 订阅 dealer的NewCarInfo方法
var michael = new Customer("Michael");
dealer.NewCarInfo += michael.NewCarIsHere;

var nick = new Customer("Nick");
//nick对象 订阅 dealer的NewCarInfo方法
dealer.NewCarInfo += nick.NewCarIsHere;

//dealer 发布动作，然后会依次调用订阅方法
//输出：
/*
CarDealer,new car 新车马自达
Michael:car 新车马自达 is new
Nick:car 新车马自达 is new
*/
dealer.NewCar("新车马自达");

```

